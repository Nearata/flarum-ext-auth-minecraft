(()=>{var t={n:o=>{var e=o&&o.__esModule?()=>o.default:()=>o;return t.d(e,{a:e}),e},d:(o,e)=>{for(var n in e)t.o(e,n)&&!t.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:e[n]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};(()=>{"use strict";function e(t,o){return e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},e(t,o)}function n(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,e(t,o)}t.r(o);const r=flarum.core.compat["common/components/Button"];var a=t.n(r);const i=flarum.core.compat["common/components/Modal"];var l=t.n(i);const s=flarum.core.compat["common/utils/Stream"];var u=t.n(s),c=function(t,o){return void 0===o&&(o={}),app.translator.trans("nearata-auth-minecraft.forum.change_email_modal."+t,o)},p=function(t){function o(){return t.apply(this,arguments)||this}n(o,t);var e=o.prototype;return e.oninit=function(o){t.prototype.oninit.call(this,o),this.user=this.attrs.user,this.success=!1,this.email=u()(this.user.email()),this.token=u()()},e.className=function(){return"ChangeEmailModal Modal--small"},e.title=function(){return c("title")},e.content=function(){return this.success?[m(".Modal-body",[m(".Form.Form--centered",[m("p.helpText",[c("confirmation_message",{email:m("strong",this.email())})]),m(".Form-group",[m(a(),{className:"Button Button--primary Button--block",onclick:this.hide.bind(this)},c("dismiss_button"))])])])]:[m(".Modal-body",[m(".Form.Form--centered",[m("p.helpText",app.translator.trans("nearata-auth-minecraft.forum.token_help")),m(".Form-group",[m("input",{className:"FormControl",type:"email",name:"email",placeholder:this.user.email(),bidi:this.email,disabled:this.loading,autocomplete:"off"})]),m(".Form-group",[m("input",{className:"FormControl",type:"text",name:"token",placeholder:c("token_placeholder"),bidi:this.token,disabled:this.loading,autocomplete:"off"})]),m(".Form-group",[m(a(),{className:"Button Button--primary Button--block",type:"submit",loading:this.loading},c("submit_button"))])])])]},e.onsubmit=function(t){var o=this;t.preventDefault(),this.email()!==this.user.email()?(this.loading=!0,this.alertAttrs=null,app.request({url:app.forum.attribute("apiUrl")+"/minecraft/changeEmail",method:"POST",body:{email:this.email(),token:this.token},errorHandler:this.onerror.bind(this)}).then((function(){o.success=!0})).catch((function(){})).then(this.loaded.bind(this))):this.hide()},e.onerror=function(o){403===o.status&&(o.alert.content=app.translator.trans("nearata-auth-minecraft.api.error_403")),t.prototype.onerror.call(this,o)},o}(l()),h=function(t){return app.translator.trans("nearata-auth-minecraft.forum."+t)},d=function(t){function o(){return t.apply(this,arguments)||this}n(o,t);var e=o.prototype;return e.oninit=function(o){t.prototype.oninit.call(this,o),this.token=u()()},e.className=function(){return"MinecraftLogInModal Modal--small"},e.title=function(){return h("log_in_modal.title")},e.content=function(){return[m(".Modal-body",[m(".Form.Form--centered",[m("p.helpText",h("token_help")),m(".Form-group",[m("input.FormControl",{bidi:this.token,placeholder:h("token_placeholder"),name:"token",type:"text",autocomplete:"off"})]),m(".Form-group",[m(a(),{type:"submit",className:"Button Button--primary Button--block",disabled:this.loading,loading:this.loading},h("log_in_modal.submit_button"))])])]),m(".Modal-footer",[m("span",["Powered by ",m("a",{href:"https://mc-oauth.net/",target:"_blank"},"Minecraft oAuth")])])]},e.onsubmit=function(t){t.preventDefault(),this.loading=!0,app.request({url:app.forum.attribute("apiUrl")+"/auth/minecraft",method:"POST",body:{token:this.token()},errorHandler:this.onerror.bind(this)}).then((function(t){app.authenticationComplete(t),"loggedIn"in t&&window.location.reload})).catch((function(){})).then(this.loaded.bind(this))},e.onerror=function(o){403===o.status&&(o.alert.content=h("error_403")),t.prototype.onerror.call(this,o)},o}(l());const f=flarum.core.compat.app;var b=t.n(f);const g=flarum.core.compat["common/extend"],y=flarum.core.compat["forum/components/LogInButtons"];var _=t.n(y);const k=flarum.core.compat["forum/components/SettingsPage"];var v=t.n(k);b().initializers.add("nearata-auth-minecraft",(function(){(0,g.extend)(_().prototype,"items",(function(t){t.add("authMinecraft",m(a(),{className:"Button LogInButton LogInButton--minecraft",onclick:function(){return b().modal.show(d)}},b().translator.trans("nearata-auth-minecraft.forum.log_in_button_title")))})),(0,g.extend)(v().prototype,"accountItems",(function(t){var o=this.user;o.email().endsWith("auth-minecraft.net")&&t.replace("changeEmail",m(a(),{className:"Button",onclick:function(){return b().modal.show(p,{user:o})}},b().translator.trans("nearata-auth-minecraft.forum.settings.change_email_button")))}))}))})(),module.exports=o})();
//# sourceMappingURL=forum.js.map