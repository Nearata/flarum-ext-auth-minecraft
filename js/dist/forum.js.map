{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@nearata/flarum-ext-auth-minecraft/webpack/bootstrap","webpack://@nearata/flarum-ext-auth-minecraft/webpack/runtime/compat get default export","webpack://@nearata/flarum-ext-auth-minecraft/webpack/runtime/define property getters","webpack://@nearata/flarum-ext-auth-minecraft/webpack/runtime/hasOwnProperty shorthand","webpack://@nearata/flarum-ext-auth-minecraft/webpack/runtime/make namespace object","webpack://@nearata/flarum-ext-auth-minecraft/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@nearata/flarum-ext-auth-minecraft/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@nearata/flarum-ext-auth-minecraft/external root \"flarum.core.compat['common/components/Button']\"","webpack://@nearata/flarum-ext-auth-minecraft/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@nearata/flarum-ext-auth-minecraft/external root \"flarum.core.compat['common/utils/Stream']\"","webpack://@nearata/flarum-ext-auth-minecraft/./src/forum/components/ChangeEmailModal.js","webpack://@nearata/flarum-ext-auth-minecraft/./src/forum/components/MinecraftLogInModal.js","webpack://@nearata/flarum-ext-auth-minecraft/external root \"flarum.core.compat['app']\"","webpack://@nearata/flarum-ext-auth-minecraft/external root \"flarum.core.compat['common/extend']\"","webpack://@nearata/flarum-ext-auth-minecraft/external root \"flarum.core.compat['forum/components/LogInButtons']\"","webpack://@nearata/flarum-ext-auth-minecraft/external root \"flarum.core.compat['forum/components/SettingsPage']\"","webpack://@nearata/flarum-ext-auth-minecraft/./src/forum/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/Stream'];","import Button from \"flarum/common/components/Button\";\nimport Modal from \"flarum/common/components/Modal\";\nimport Stream from \"flarum/common/utils/Stream\";\n\nconst trans = (key, options = {}) => {\n    return app.translator.trans(\n        `nearata-auth-minecraft.forum.change_email_modal.${key}`,\n        options\n    );\n};\n\nexport default class ChangeEmailModal extends Modal {\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        this.user = this.attrs.user;\n\n        this.success = false;\n        this.email = Stream(this.user.email());\n        this.token = Stream();\n    }\n\n    className() {\n        return \"ChangeEmailModal Modal--small\";\n    }\n\n    title() {\n        return trans(\"title\");\n    }\n\n    content() {\n        if (this.success) {\n            return [\n                m(\".Modal-body\", [\n                    m(\".Form.Form--centered\", [\n                        m(\"p.helpText\", [\n                            trans(\"confirmation_message\", {\n                                email: m(\"strong\", this.email()),\n                            }),\n                        ]),\n                        m(\".Form-group\", [\n                            m(\n                                Button,\n                                {\n                                    className:\n                                        \"Button Button--primary Button--block\",\n                                    onclick: this.hide.bind(this),\n                                },\n                                trans(\"dismiss_button\")\n                            ),\n                        ]),\n                    ]),\n                ]),\n            ];\n        }\n\n        return [\n            m(\".Modal-body\", [\n                m(\".Form.Form--centered\", [\n                    m(\n                        \"p.helpText\",\n                        app.translator.trans(\n                            \"nearata-auth-minecraft.forum.token_help\"\n                        )\n                    ),\n                    m(\".Form-group\", [\n                        m(\"input\", {\n                            className: \"FormControl\",\n                            type: \"email\",\n                            name: \"email\",\n                            placeholder: this.user.email(),\n                            bidi: this.email,\n                            disabled: this.loading,\n                            autocomplete: \"off\",\n                        }),\n                    ]),\n                    m(\".Form-group\", [\n                        m(\"input\", {\n                            className: \"FormControl\",\n                            type: \"text\",\n                            name: \"token\",\n                            placeholder: trans(\"token_placeholder\"),\n                            bidi: this.token,\n                            disabled: this.loading,\n                            autocomplete: \"off\",\n                        }),\n                    ]),\n                    m(\".Form-group\", [\n                        m(\n                            Button,\n                            {\n                                className:\n                                    \"Button Button--primary Button--block\",\n                                type: \"submit\",\n                                loading: this.loading,\n                            },\n                            trans(\"submit_button\")\n                        ),\n                    ]),\n                ]),\n            ]),\n        ];\n    }\n\n    onsubmit(e) {\n        e.preventDefault();\n\n        if (this.email() === this.user.email()) {\n            this.hide();\n            return;\n        }\n\n        this.loading = true;\n        this.alertAttrs = null;\n\n        app.request({\n            url: `${app.forum.attribute(\"apiUrl\")}/minecraft/changeEmail`,\n            method: \"POST\",\n            body: { email: this.email(), token: this.token },\n            errorHandler: this.onerror.bind(this),\n        })\n            .then(() => {\n                this.success = true;\n            })\n            .catch(() => {})\n            .then(this.loaded.bind(this));\n    }\n\n    onerror(error) {\n        if (error.status === 403) {\n            error.alert.content = app.translator.trans(\n                \"nearata-auth-minecraft.api.error_403\"\n            );\n        }\n\n        super.onerror(error);\n    }\n}\n","import Button from \"flarum/common/components/Button\";\nimport Modal from \"flarum/common/components/Modal\";\nimport Stream from \"flarum/common/utils/Stream\";\n\nconst trans = (key) => {\n    return app.translator.trans(`nearata-auth-minecraft.forum.${key}`);\n};\n\nexport default class MinecraftLogInModal extends Modal {\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        this.token = Stream();\n    }\n\n    className() {\n        return \"MinecraftLogInModal Modal--small\";\n    }\n\n    title() {\n        return trans(\"log_in_modal.title\");\n    }\n\n    content() {\n        return [\n            m(\".Modal-body\", [\n                m(\".Form.Form--centered\", [\n                    m(\"p.helpText\", trans(\"token_help\")),\n                    m(\".Form-group\", [\n                        m(\"input.FormControl\", {\n                            bidi: this.token,\n                            placeholder: trans(\"token_placeholder\"),\n                            name: \"token\",\n                            type: \"text\",\n                            autocomplete: \"off\",\n                        }),\n                    ]),\n                    m(\".Form-group\", [\n                        m(\n                            Button,\n                            {\n                                type: \"submit\",\n                                className:\n                                    \"Button Button--primary Button--block\",\n                                disabled: this.loading,\n                                loading: this.loading,\n                            },\n                            trans(\"log_in_modal.submit_button\")\n                        ),\n                    ]),\n                ]),\n            ]),\n            m(\".Modal-footer\", [\n                m(\"span\", [\n                    \"Powered by \",\n                    m(\n                        \"a\",\n                        {\n                            href: \"https://mc-oauth.net/\",\n                            target: \"_blank\",\n                        },\n                        \"Minecraft oAuth\"\n                    ),\n                ]),\n            ]),\n        ];\n    }\n\n    onsubmit(e) {\n        e.preventDefault();\n\n        this.loading = true;\n\n        app.request({\n            url: `${app.forum.attribute(\"apiUrl\")}/auth/minecraft`,\n            method: \"POST\",\n            body: { token: this.token() },\n            errorHandler: this.onerror.bind(this),\n        })\n            .then((response) => {\n                app.authenticationComplete(response);\n                if (\"loggedIn\" in response) {\n                    window.location.reload;\n                }\n            })\n            .catch(() => {})\n            .then(this.loaded.bind(this));\n    }\n\n    onerror(error) {\n        if (error.status === 403) {\n            error.alert.content = trans(\"error_403\");\n        }\n\n        super.onerror(error);\n    }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/LogInButtons'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/SettingsPage'];","import ChangeEmailModal from \"./components/ChangeEmailModal\";\nimport MinecraftLogInModal from \"./components/MinecraftLogInModal\";\nimport app from \"flarum/app\";\nimport Button from \"flarum/common/components/Button\";\nimport { extend } from \"flarum/common/extend\";\nimport LogInButtons from \"flarum/forum/components/LogInButtons\";\nimport SettingsPage from \"flarum/forum/components/SettingsPage\";\n\napp.initializers.add(\"nearata-auth-minecraft\", () => {\n    extend(LogInButtons.prototype, \"items\", function (items) {\n        items.add(\n            \"authMinecraft\",\n            m(\n                Button,\n                {\n                    className: \"Button LogInButton LogInButton--minecraft\",\n                    onclick: () => app.modal.show(MinecraftLogInModal),\n                },\n                app.translator.trans(\n                    \"nearata-auth-minecraft.forum.log_in_button_title\"\n                )\n            )\n        );\n    });\n\n    extend(SettingsPage.prototype, \"accountItems\", function (items) {\n        const user = this.user;\n\n        if (user.email().endsWith(\"auth-minecraft.net\")) {\n            items.replace(\n                \"changeEmail\",\n                m(\n                    Button,\n                    {\n                        className: \"Button\",\n                        onclick: () =>\n                            app.modal.show(ChangeEmailModal, { user }),\n                    },\n                    app.translator.trans(\n                        \"nearata-auth-minecraft.forum.settings.change_email_button\"\n                    )\n                )\n            );\n        }\n    });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","flarum","core","compat","trans","options","app","translator","ChangeEmailModal","oninit","vnode","this","user","attrs","success","email","Stream","token","className","title","content","m","Button","onclick","hide","type","name","placeholder","bidi","disabled","loading","autocomplete","onsubmit","e","preventDefault","alertAttrs","request","url","forum","attribute","method","body","errorHandler","onerror","then","loaded","error","status","alert","Modal","MinecraftLogInModal","href","target","response","authenticationComplete","window","location","reload","extend","LogInButtons","items","add","SettingsPage","endsWith","replace"],"sourceRoot":""}